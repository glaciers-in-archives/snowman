# Test building a simple single-page site
# This test verifies that Snowman can build a basic site with:
# - A snowman.yaml config file
# - A views.yaml with a single static view
# - A SPARQL query file
# - A template with layout
# - Expected HTML output

# Build the site
exec snowman build
stdout 'Building project'

# Verify the output directory exists
exists site/index.html

# Verify static files were copied
exists site/css/style.css

# Check that the generated HTML contains expected content
grep 'Welcome to Test Site' site/index.html
grep 'test site generated by Snowman' site/index.html
grep 'Test Site' site/index.html

# Verify cache directory was created
exists .snowman/cache/sparql

-- snowman.yaml --
sparql_client:
  endpoint: "MOCK_SPARQL_ENDPOINT"
  http_headers:
    User-Agent: "Snowman Integration Test"
snowman_version: ">=0.7.0"
site_title: "Test Site"

-- views.yaml --
views:
  - output: "index.html"
    query: "index.rq"
    template: "index.html"

-- queries/index.rq --
# Simple SELECT query for index page
SELECT ?title ?description WHERE {
  # This query will be intercepted by the mock server
  # The mock looks for "index" in the query to return test data
  VALUES (?placeholder) { ("index") }
}

-- templates/layouts/base.html --
{{ define "base" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ block "title" . }}{{ end }}</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    {{ block "content" . }}{{ end }}
</body>
</html>
{{ end }}

-- templates/index.html --
{{ template "base" . }}

{{ define "title" }}{{ config.Metadata.site_title }}{{ end }}

{{ define "content" }}
<div class="container">
    {{ range . }}
    <h1>{{ .title }}</h1>
    <p>{{ .description }}</p>
    {{ end }}
</div>
{{ end }}

-- static/css/style.css --
body {
    font-family: sans-serif;
    margin: 0;
    padding: 20px;
}

.container {
    max-width: 800px;
    margin: 0 auto;
}
